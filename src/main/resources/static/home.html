<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title style="text-align:center">Home</title>
    <style>
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        td, th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        tr:nth-child(even) {
            background-color: #dddddd;
        }
    </style>
<!--    &lt;!&ndash; Latest compiled and minified CSS &ndash;&gt;-->
<!--    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">-->

<!--    &lt;!&ndash; jQuery library &ndash;&gt;-->
<!--    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>-->

<!--    &lt;!&ndash; Latest compiled JavaScript &ndash;&gt;-->
<!--    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>-->
    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
</head>
<body>
<div>
    <h1>Home</h1>
</div>

<br>


<div id="userInfo">
    <h2>My User Info</h2>
</div>

<div id="myTx">
    <h2>My Transactions</h2>
</div>
<input type="button" value="Sell Currency" style="background-color: green; font-weight: bolder" onclick="function clickSellCurrencyButton() {
    window.open(`/transactionSell.html`, `_self`)
}
clickSellCurrencyButton()"/><br>

<input type="button" value="Buy Currency" style="background-color: green;font-weight: bolder" onclick="function clickBuyCurrencyButton() {

}
clickBuyCurrencyButton()"/><br>
<br>

<br>
<input type="button" value="View Currencies" style="font-weight: bolder" onclick="function clickViewCurrenciesButton() {
    window.open(`/viewCurrencies.html`)
}
clickViewCurrenciesButton()"/><br>
<br>
<input type="button" value="Search Rates" style="font-weight: bolder" onclick="function clickSearchRateButton() {
    window.open(`/searchRates.html`)
}
clickSearchRateButton()"/><br>

<input type="button" value="Logout" style="background-color: red; font-weight: bolder" onclick="function clickLogoutButton() {
    sessionStorage.clear();
    window.location.replace(`/login.html`)
}
clickLogoutButton()"/><br>

<div id="search user">
    <label for="usernameInput">Username:</label>
    <input id="usernameInput" name="username" type="text"><br>
</div>
<input type="button" value="Search User" style="font-weight: bolder" onclick="function clickSearchUserButton() {
    sessionStorage.setItem(`searchUser`, document.getElementById(`usernameInput`).value);
    window.open(`/portfolio.html`, `_self`)
}
clickSearchUserButton()"/><br>

<script type="text/javascript">
<!--    UserInfo-->
    const user = JSON.parse(sessionStorage.getItem("user"));
    if(user !== null) {
        console.log(`user = ${user}`);
        const userInfoDiv = document.getElementById("userInfo");
        userInfoDiv.innerHTML += '<ul>';
        userInfoDiv.innerHTML += `<br>User ID: ${user.userID}`;
        userInfoDiv.innerHTML += `<br>Username: ${user.username}`;
        userInfoDiv.innerHTML += `<br>First Name: ${user.firstName}`;
        userInfoDiv.innerHTML += `<br>Last Name: ${user.lastName}`;
        userInfoDiv.innerHTML += `<br>Email Address: ${user.email}`;
        userInfoDiv.innerHTML += `<br>Country: ${user.country}`;
        userInfoDiv.innerHTML += '</ul>';
    }else{
        window.location.replace(`/login.html`);
    }
// My Tx
    fetch('/transaction/user/' + user.userID.toString(), {method: 'GET', headers: {},})
    .then(res => res.json())
        .then(async res => {
            let html = '<table>';
            html += '<tr>';
            html += '<th>Seller</th>';
            html += '<th>Buyer</th>';
            html += '<th>From</th>';
            html += '<th>To</th>';
            html += '<th>Rate</th>';
            html += '<th>Amount</th>';
            html += '<th>Price</th>';
            html += '<th>Expiry Date</th>';
            html += '<th>Finished</th>';
            html += '</tr>';

            for (const elem of res) {
                html += '<tr>';
                // html += '<td>' + elem.sellerID +'</td>';
                if (elem.sellerID == 0){
                    html += '<td>-</td>';
                }else{
                    await fetch('/users?id=' + elem.sellerID, {method: 'GET', headers: {},})
                        .then(res => res.json())
                        .then(res => {
                            html += '<td>' + res.username + '</td>';
                        });
                }
                if (elem.buyerID == 0){
                    html += '<td>-</td>';
                }else{
                    await fetch('/users?id=' + elem.buyerID, {method: 'GET', headers: {},})
                        .then(res => res.json())
                        .then(res => {
                            html += '<td>' + res.username + '</td>';
                        });
                }
                // html += '<td>' + elem.buyerID + '</td>';
                html += '<td>' + elem.currencyCodeFrom + '</td>';
                html += '<td>' + elem.currencyCodeTo + '</td>';
                html += '<td>' + elem.rate + '</td>';
                html += '<td>' + elem.amount + '</td>';
                html += '<td>' + elem.price + '</td>';
                html += '<td>' + elem.expiryDate + '</td>';
                html += '<td>' + elem.approved + '</td>';
                html += '</tr>';
            }
            html += '</table>';
            document.getElementById("myTx").innerHTML += html;
            return res;
        }).catch(error => {console.error(error);})

</script>

</body>
</html>